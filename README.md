# 강원도의 산불 발생 예측 및 예보서비스

**프로젝트 진행기간** : 2023.02~2023.06 <br><br>

**프로젝트 기획이유**  <br><br>
산불은 발생하게 되면 엄청난 피해를 입히는 재해이다. 이런 산불은 매년 전세계적으로 많은 피해를 입히고 있으며, 우리나라에서도 많은 이들이 산불로 인해 피해를 보고있다. 이에 산불을 기존 수치모델이아닌 딥러닝을 적용하여 예측 및 예보하고자 이 프로젝트를 진행하게 되었다. 우리나라의 경우 산불의 원인의 약 90%가 인간에 의한 발화라고 한다. 이에 기존의 기상과 지형에 의존하는 산불 예측이 아닌, 인간을 나타내는 데이터를 추가로 활용하여 산불을 예측하고자 하였고, 이를 위해 멀티모달 학습방식을 고안하였다.
<br><br>

**프로젝트 진행과정** <br>

<details>
<summary> 초기 계획 및 진행과정 2023.02.01~2023.03.12 </summary>
<div markdown="1">       

# Forecasting-the-risk-of-forest-fires
## 산불 위험도 예측을 통한 정보제공 서비스
[2023-1] Capstone Project @SJU

project term 2023.02.01~

## 기상인자와 **인간인자**를 반영한 산불 위험도 예측

- 전국 데이터를 바탕으로 학습을 진행한 뒤 행정구역별(읍면동)로 나누어 위험도 표시

- 며칠전간의 기상적 데이터를 바탕으로 ~~한시간 뒤~~ 전국의 산불 위험도가 어떻게 될 것이다.
  - 일단은 현시점의 위험도 예측
  - 성능 나올시에 기상청에서 제공하는 데이터를 통한 n시간 뒤 위험도 예측

- 각 지역적 특성을 반영하기 위해 자연적 데이터 및 기상데이터 정규화 진행
  - 행정구역별인 이유 : 소방서와 같은 요인은 행정구역별이 더 의미있음.
  
- 웹 사이트 구현

## 데이터

- 산불피해대장 ( 2001 ~ 2022 )
- 기상 데이터 → ASOS + AWS
- 인적 데이터 → 소방서, 등산로, 대도시 인접도
- 자연적 데이터 → TPI, 임업도

## 정규화
정규화의 이유 -> 지역 별로 다른 기상적 특성을 가지고 있기 때문
- 산불발생지역별 정규화(Aws 기준 정규화)
- 전체기상데이터 정규화

## 결측치 처리 - (상대습도, 실효습도, 강수량, 풍속, 기온)
1. 가장 인접한 관측소에서 데이터 끌어오기
2. 거리가 30km 이상이면 그 지역의 연간 월평균으로 채우기 
3. 데이터 특성상 월 평균이 의미가 적을 수 있음 - 추가 결측치 처리방안 필요
  - 이동평균으로 결측값 채우기
  - 보간법으로 NAN 처리 후 사전관찰 방지를 위해 이전의 데이터 사용하기

## 모델링
- 분류기반모델 -> Randomforest/Catboost

## Process
1. AWS, ASOS Raw 데이터 수집 → 시계열
2. 데이터 윈도우 추가 (4일)
3. 실효습도 피처 추가
4. 섬은 drop
5. AWS(기상인자), ASOS(상대습도) 지점별 이동평균으로 결측값 채우기
6. 정규화 진행 여부
    1. 정규화 미진행
        1. 임상도 포함 데이터(4922개)
        2. 임상도 미포함 데이터
    2. 지점별 정규화 진행
        1. 임상도 포함 데이터(4922개)
        2. 임상도 미포함 데이터
<br><br>
<aside>
💡 1st goal : 기상인자만으로 진행
<br>
</aside>

<aside>
💡 2nd goal : 기상인자에 지형적특성(임상도) 반영
<br>
</aside>

<aside>
💡 final goal : 기상인자 + 지형적특성 + 인적특성
<br>
</aside>
</div>
</details>

<details>
<summary> 세부 계획 및 진행과정 2023.03.13~2023.06 </summary>
<div markdown="1">       
  
### 새로운 IDEA

기존 Dataframe 형태로 분석을 진행할시의 문제점으로

1. 정확한 산불 발생위치의 기상 정보를 고려할 수 없다.
2. 산불이 난 지점의 임상이나 경사같은 지형요인을 반영하기 어렵다.
3. 피해면적을 라벨로 학습하여 피해 예상면적을 구하기에는 발생이후의 기상인자를 고려하지 않는다.
4. 인적 특성을 반영하기 어렵다.

와 같은 문제가 있었다.

- 따라서 이런 문제를 해결하고자 기상인자들 및 식생지수, 지형(TPI)등의 이미지 데이터를 수집하여 산불발생지역 
<br>인근을 Crop하고 발생 데이터에 1을 라벨링하여 **산불 발생 예측**으로 전환하기로 결정하였다. 

- 이미지 데이터의 수집 및 실시간 서비스에 활용하기위한 자동화 문제가 현재 관건이며 이를 해결시에 <br>
한국에서 기존에 시도하지 않은 방식의 분석기법이 될 것으로 기대된다.
<br>

**2023.03.22**
<br>

현재 진행도 :
  1. QGIS를 통해 AWS 지점별 보간이 가능한 것을 확인 후 파이썬에서 이를 자동화하는 방안 발견
  2. 선행연구들을 통해 반영할 피쳐들을 찾고 스케일이 어떤지 

추후 계획 : 데이터 수집 자동화로 이미지로 된 기상 및 지형적 요인, 추가로 인적요인까지 반영하여 딥러닝을 통해 <br>
산불 발생예측을하여 이를 확률로 구분하여 지점별 발생가능성을 시각화할 것임

<br><br>
**2023.04.10 진행상황**
- 파이썬으로 AWS 관측 지점 데이터를 불러와서 IDW 방식으로 보간하여 전국의 데이터를 생성
- 그중 강원도 부분만 잘라서 raster 형태로 수집

- <b>How to Crop?</b>
  1. Raster 파일을 csv 형태로 변환하여 Index를 뽑고 Dataframe에 접근하는 형태로 Crop 
  2. Crop한 파일은 csv 형태이므로 다시 이미지로 변환하기 위해서 csv to raster 과정을 진행 
  3. raster는 회색조로 여러 피쳐를 전부 회색조로 학습시키면 정확한 특징 추출이 어려울 것으로<br> 예상되어 함수를 정의하여 컬라형태로 plot을 띄운 후, 이미지로 저장 
  4. 컬러형태의 png 이미지를 모델의 input으로 사용 <br>

<br><br>

**2023.04.11 진행상황**
- 산불난 지점에 대한 이미지 크롭 완료. 
  - 기상 (기온, 습도, 강수량, 풍속, 실효습도)
- RGB 이미지 5개를 하나의 input으로 학습시키기 위한 데이터 로더 생성 및 모델링 진행중

해야할일
- 맵 보간시에 결측값이 많아서 이를 처리해야함
- 기상 데이터와 지형 및 인적요소의 스케일을 맞추어야함

<br><br>


**2023.04.24 진행상황**
- 기상데이터 결측값을 처리 후 보간 완료 (04.12~04.13)
![image](https://github.com/smart0515/Forecasting-the-occurrence-of-Wildfires/assets/48974564/cd4d7c84-3ace-4f30-8e41-7f1ecf24342a)
- 이미지를 하나로 병합하여 input image 생성완료 (04.13)
- 테스트를 위해 강원도의 랜덤지점의 최근 10년간 계절 별로 동일한 비율만큼의 기상데이터를 추출 및 이미지화 (04.14~04.17)
- Baseline 모델 구축 (04.17~04.21)

해야할일
- 강원도를 원하는 해상도 만큼의 맵으로 나타내기 
  - 현재 메모리 이슈로 인해 원활한 데이터 수집불가 (04.14~) -> 분할하여 수집하는 방식으로 수집완료(5.2)
  - 차선책으로 일정한 비율로 맵을 나누어 산불위험도를 구한뒤 보간하는 방식을 적용 (04.23) -> 완료(4.27)
      - 지정한 해상도와 경위도를 맵핑시켜야함 (04.23~) -> 완료(4.27)
- 지형적, 인적요인 이미지화 -> 모델에 입력값으로 추가계획 (04.17~) -> 완료(5.6)

![image](https://github.com/smart0515/Forecasting-the-occurrence-of-Wildfires/assets/48974564/2c2827e9-a1f2-41e4-96b5-535d3f4aca5e)
<br><br>
**2023.05.12 진행상황**
- 지형요인 데이터 수집 및 처리완료
  - NDVI
  - 임상도
  - 경사도
  - 고도
- 기상데이터를 이미지화 할 시에 데이터 생성시간이 길다는 문제가 있었음
    → 따라서 기상데이터는 정형데이터(Tabular) 형태로 사용하고 지형을 이미지로 하여 학습하는 멀티모달 방식을 사용
<br><br>

**이로 인하여 데이터 생성시간이 매우 단축되어 실시간 서비스까지 제공할 수 있을 것으로 예상**
<br><br>

해야할일
<br>
- 멀티모달로 생성한 모델을 적용하여 테스트
- 인적요소 데이터 수집
- 실험을 통해 피처들의 설명력 

<br><br>

**2023.05.20 진행상황**
- 지형이미지 4개(NDVI, 임상도, 경사도, 고도)와 Tabular 데이터(기상) 멀티모달 모델 생성 완료
  - test를 통해 모델 하이퍼파라미터튜닝 진행중
  - 인적요소 데이터 수집완료 (인구밀도, LandUse) 이미지 형태
<br><br>

**멀티모달 모델사용으로 인해 기상 데이터를 이미지화하는 과정이 생략되어 실시간 서비스 제공가능해졌음**
  - pickle 파일로 모델 저장하여 실시간 서비스 제공 예정

<br>

해야할일
<br>
- 멀티모달로 생성한 모델을 적용하여 테스트
- 실험을 통해 피처들의 설명력 

<br><br>

**2023.05.24 진행상황**
- 인적요소 데이터 처리 완료
- 서비스화를 위해 기상 데이터 크롤링 및 모델링 자동화 진행중
- 기존 데이터의 미세한 좌표계 오차문제 
- 임상도 데이터는 군사 분계선으로 인해 데이터가 수집되지 않은 곳이 다수라서 강원도 한정 사용하기 어려움
<br><br>
![image](https://github.com/smart0515/Forecasting-the-occurrence-of-Wildfires/assets/48974564/565e9ed0-ec9a-4beb-8f9b-e1cf20e719e6)

**2023.05.31 진행상황**
- **기상+지형 vs 기상+지형+인적요소**의 비교를 통해 인적요소의 의미 도출
- 초단기예보 크롤링 및 모델링 자동화 완료
- 데이터간의 미세오차 해결
- 웹 페이지에 서비스 
- 최종 결과물 도출

![image](https://github.com/smart0515/Forecasting-the-occurrence-of-Wildfires/assets/48974564/c9e9b35f-03f1-4cb7-b765-90714140cb01)

<br><br>
- 토지이용도(Landuse) tif 데이터 위에 산불난 지점을 표현해본 결과,
  - 고도가 낮고
  - 주거지역 및 상업지역등의 용도인 지역이며
  - 인구밀도가 높은 지역
인 경우에 산불이 많이 발생했음을 확인할 수 있었다.

![image](https://github.com/smart0515/Forecasting-the-occurrence-of-Wildfires/assets/48974564/774899eb-7fab-4266-8a36-32d4d649a5ec)

정리하자면 고도가 낮은 평지부근에 인구가 많이 밀집되어 있고,<br>
이 지점의 **기상+지형** 요인만으로 분석할때보다 **기상+지형+인적요인**으로 분석시 **더 높은 산불 발생확률**을 보인다.<br>
이에 따라 산불이라는 발생원인이 매우 불규칙한 재해에 대해서 **인간의 요인이 반영됨**을 확인할 수 있다.

</details>


<br>

**프로젝트 발표영상**
https://www.youtube.com/watch?v=OtBLeOMWvPY
